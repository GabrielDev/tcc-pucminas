<form [formGroup]="pedidoForm" (submit)="finalizar()">
  <div class="header pb-8 pt-5 pt-lg-8 d-flex align-items-center">
    <span class="mask bg-gradient-danger opacity-8"></span>
    <div class="container-fluid align-items-center">
      <div class="row">
        <div class="col-12">
          <div class="form-group">
            <label for="cliente" class="text-white form-control-label">Cliente</label>
            <p-autoComplete 
              id="cliente"
              styleClass="btn-block"
              inputStyleClass="form-control form-control-alternative border-0 form-control-lg rounded-pill "
              field="nome"
              formControlName="cliente" 
              [suggestions]="clientes" 
              [forceSelection]="true"
              (completeMethod)="buscarClientes($event)"
              placeholder="Buscar cliente por nome ou cpf">
              <ng-template let-cliente pTemplate="cliente">
                <div class="list-group-item list-group-item-action">
                  <div class="row align-items-center">
                    <div class="col-auto">
                      <img [alt]="cliente.nome" [src]="cliente.foto" class="avatar rounded-pill">
                    </div>
                    <div class="col ml--2">
                      <h4 class="mb-0 text-sm">{{ cliente.nome }}</h4>
                    </div>
                  </div>
                </div>
              </ng-template>
            </p-autoComplete>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid mt--7">
    <div class="row">
      <div class="col-xl-4 order-xl-2 mb-5 mb-xl-0">
        <div class="card card-profile shadow mb-3">
          <div class="card-header text-center border-0 pt-md-4 pb-0">
            <div class="d-flex justify-content-between">
              <button class="btn btn-sm btn-outline-primary btn-block" [routerLink]="['/cliente/novo']">Novo cliente</button>
            </div>
          </div>
          <div class="card-body pt-0 pt-md-4">
            <div class="row">
              <div class="col">
                <div class="card-profile-stats">
                  <div class="form-group mb--2">
                    
                  </div>
                </div>
              </div>
            </div>
            
            <div [hidden]="!f.cliente.value" class="text-center">
              <h3>{{ f.cliente.value?.nome }}</h3>
              <hr class="my-4" />
              <p>{{ f.cliente.value?.endereco }}</p>
              <div>
                <i class="ni education_hat mr-2"></i>{{ f.cliente.value?.bairro }}
              </div>
              <div class="h5 font-weight-300">
                <i class="ni location_pin mr-2"></i>{{ f.cliente.value?.cidade }} - {{ f.cliente.value?.estado.descricao }}
              </div>
            </div>
          </div>
        </div>

        <div class="card card-stats shadow">
          <div class="card-body">
            <div class="row">
              <div class="col">
                <h5 class="card-title text-uppercase text-muted mb-0">Total</h5>
                <span [hidden]="!f.total.value" class="h2 font-weight-bold mb-0 text-right">{{ f.total.value | currency: 'BRL' }}</span>
              </div>
              <div class="col-auto">
                <div class="icon icon-shape bg-red text-white rounded-circle shadow">
                  <i class="ni ni-active-40"></i>
                </div>
              </div>
            </div>
            <p class="mt-3 mb-0 text-sm" [hidden]="!f.patazBonusTotal.value">
              <span class="text-success mr-2"><i class="fa fa-arrow-up"></i> {{ f.patazBonusTotal.value }}</span>
              <span class="text-nowrap">Pataz acumulados</span>
            </p>
          </div>

          <div class="card-footer">
            <button type="submit" class="btn btn-xs btn-primary btn-block" [disabled]="!f.itens.length">Finalizar</button>
          </div>
        </div>
      </div><!-- col-xl-4 -->

      <div class="col-xl-8 order-xl-1">
        <div class="card bg-secondary shadow">
          <div class="card-header bg-white border-0">
            <div class="row align-items-center">
              <div class="col-12">
                <h3 class="mb-0">Pedidos</h3>
              </div>
              <div class="col-12">
                <label class="form-control-label" for="item">Adicionar item</label>
                <p-autoComplete 
                  id="item"
                  styleClass="btn-block"
                  inputStyleClass="form-control form-control-alternative border-0"
                  field="descricao"
                  [suggestions]="itensVenda" 
                  [forceSelection]="true"
                  (completeMethod)="buscarItensVenda($event)"
                  (onSelect)="adicionar($event)"
                  placeholder="Buscar produto ou serviço por nome">
                  <ng-template let-item pTemplate="item">
                    <div class="list-group-item list-group-item-action">
                      <div class="row align-items-center">
                        <div class="col-auto">
                          <img [alt]="item.descricao" [src]="item.foto" class="avatar rounded-pill">
                        </div>
                        <div class="col ml--2">
                          <div class="d-flex justify-content-between align-items-center">
                            <div>
                              <h4 class="mb-0 text-sm">{{ item.descricao }}</h4>
                            </div>
                            <div class="text-right text-muted">
                              <h4>{{ item.valor | currency: 'BRL' }}</h4>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-template>
                </p-autoComplete>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table align-items-center table-flush">
                <thead class="thead-light">
                  <tr>
                    <th scope="col">Item</th>
                    <th scope="col">Qtde</th>
                    <th scope="col">Unitário</th>
                    <th scope="col">Total</th>
                    <th scope="col"></th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let pedidoItem of f.itens.value">
                    <th scope="row">
                      <div class="media align-items-center">
                        <a href="javascript:void(0)" class="avatar rounded-circle mr-3">
                          <img [alt]="pedidoItem.item.descricao" [src]="pedidoItem.item.foto">
                        </a>
                        <div class="media-body">
                          <span class="mb-0 text-sm">{{ pedidoItem.item.descricao }}</span>
                        </div>
                      </div>
                    </th>
                    <td>
                      <div class="form-group">
                        <input
                          type="number"
                          id="quantidade"
                          name="quantidade"
                          class="form-control"
                          required
                          min="1"
                          [value]="pedidoItem.quantidade"
                          (change)="alterarQuantidade($event)"/>
                      </div>
                    </td>
                    <td>
                      <h5>R$ {{ pedidoItem.precoUnitario }}</h5>
                    </td>
                    <td>
                      <h5>R$ {{ pedidoItem.precoTotal }}</h5>
                    </td>
                    <td class="text-right">
                      <button
                        type="button"
                        class="btn btn-outline-secondary"
                        title="Remover"
                        (click)="remover(pedidoItem.item)"
                        ngbTooltip="Remover">
                        <i class="fa fa-trash"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
                <tfoot [hidden]="f.itens.length > 0">
                  <tr>
                    <td colspan="5" class="text-center">
                      <h5 class="h3">Carrinho vazio</h5>
                      <div class="h5 font-weight-300">
                        Adicione produtos ou serviços utilizando a busca acima
                      </div>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>

            <div [hidden]="!f.itens?.value.length">
              <hr class="my-4" />
              <!-- Description -->
              <h6 class="heading-small text-muted mb-4">Forma de pagamento</h6>
              <div class="pl-lg-4">
                <div class="tab-pane tab-example-result fade show active" role="tabpanel" aria-labelledby="card-stats-component-tab">
                  <div class="card-columns">
                    <label *ngFor="let pagamento of pagamentos" [for]="pagamento.id" class="card card-stats">
                      <div class="card-body">
                        <div class="row">
                          <div class="col">
                            <span class="h2 font-weight-bold mb-0">{{ pagamento.descricao }}</span>
                          </div>
                          <div class="col-auto">
                            <div class="icon icon-shape bg-red text-white rounded-circle shadow">
                              <i class="ni ni-active-40"></i>
                            </div>
                          </div>
                        </div>
                      </div>
                      <input
                        [id]="pagamento.id"
                        type="radio"
                        name="pagamento"
                        [value]="pagamento"
                        [checked]="pagamento.id == f.pagamento?.id"
                        (change)="selecionarPagamento()">
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>